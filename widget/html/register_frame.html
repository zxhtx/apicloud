<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
  <title>注册Frame</title>
  <link rel="stylesheet" type="text/css" href="../css/api.css" />
  <style>
  .row {
    box-sizing: border-box;
    width: auto;
    height: 70px;
    margin-left: 32px;
    margin-right: 32px;
    padding-top: 40px;
    border-bottom: 1px solid #888;
  }

  .input {
    width: 100%;
    height: 20px;
    line-height: 20px;
    border: none;
    font-size: 16px;
  }

  .btn {
    width: auto;
    height: 50px;
    margin-left: 32px;
    margin-right: 32px;
    margin-top: 50px;
    background-color:black ;
    line-height: 50px;
    color: white;
    font-size: 16px;
    text-align: center;
    border-radius: 8px;
  }

  .highlight {
    opacity: 0.7;
  }
</style>
</head>

<body>
  <div class="row">
    <input id="username" class="input" type="text" placeholder="用户名(英文/数字)">
  </div>
  <div class="row">
    <input id="password" class="input" type="password" placeholder="密码(7位字符即可)">
  </div>
  <div class="row">
    <input id="QQ" class="input" type="text" placeholder="QQ号码(方便后期找回密码或用户名)">
  </div>
  <div class="btn" tapmode onclick="Register()">注册</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript">
 var now;
 var appKey;
 apiready = function() {
  now = Date.now();
  appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now

};
var username;
var password;
var qqval;
var usernameValue;
var passwordValue;
var qqValue;
var skip=0;
var LIMIT=20;


function Register(){
 username=$api.byId('username');
 password=$api.byId('password');
 qqval=$api.byId('QQ');

 if (username.value.length<5) {
  api.toast({
    msg: '用户名不能低于5位字符',
    duration: 2000,
    location: 'bottom'
  });
  return;
}else if (password.value.length<7) {
  api.toast({
    msg: '密码不能低于7位字符',
    duration: 2000,
    location: 'bottom'
  });
  return;
}
usernameValue=username.value;
passwordValue=password.value;
qqValue=qqval.value;


if (usernameValue=='') {
  api.toast({
    msg:'用户名不能为空',
    duration: 2000,
    location: 'bottom'
  });
  return;

}else if(passwordValue==''){
  api.toast({
    msg:'密码不能为空',
    duration: 2000,
    location: 'bottom'
  });
  return;
}else if (qqValue==''){
 api.toast({
  msg:'QQ号不能为空',
  duration: 2000,
  location: 'bottom'
});
 return;

}



zhuce();



}

function zhuce(){
  api.ajax({
    url: 'https://d.apicloud.com/mcm/api/user',
    method: 'post',
    headers: {
      "X-APICloud-AppId": "A6099267504667",
      "X-APICloud-AppKey":   appKey
    },
    data: {
      values: { 
        'username': usernameValue,
        'password':passwordValue,
        'pwd':passwordValue,
        'QQ':qqValue
      },

    }
  },function(ret, err){
    if (ret) {
      if (ret && ret.id) {

        api.execScript({
          name: 'login',
          frameName: 'login_frame',
          script: 'setUserName(\"'+usernameValue+'\");'
        });
        api.closeWin();


      }else{
        api.toast({
            msg: '该用户名已被其他用户注册',
            duration: 2000,
            location: 'bottom'
        });
      }
    } 
  });
}
</script>

</html>
