<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
  <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
  <title>APICloud App</title>
  <link rel="stylesheet" type="text/css" href="./css/api.css" />
  <style>
  html,
  body {
    height: 100%;
  }

  body {
    display: -webkit-box;
    display: -webkit-flex;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-flex-flow: column;
    flex-flow: column;
  }

  section {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    flex: 1;
  }

  header {
    position: relative;
    height: auto;
  }

  footer {
    display: -webkit-box;
    display: -webkit-flex;
    display: flex;
    box-sizing: border-box;
    height: 50px;
    background-color: rgb(250, 250, 250);
    border-top: 1px solid #ccc;
  }

  footer>div {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    flex: 1;
    width: 100%;
    color: rgb(165, 165, 165);
    font-size: 12px;
    text-align: center;
    padding-bottom: 4px;
    padding-top: 34px;
    background-repeat: no-repeat;
    background-position: center 6px;
    background-size: auto 24px;
  }

  footer>div:nth-child(1) {
    background-image: url(./image/footer/home.png);
  }

  footer>div:nth-child(2) {
    background-image: url(./image/footer/groupbuy.png);
  }

  footer>div:nth-child(3) {
    background-image: url(./image/footer/find.png);
  }

  footer>div:nth-child(4) {
    background-image: url(./image/footer/my.png);
  }

  footer>div:nth-child(1).active {
    background-image: url(./image/footer/home_act.png);
    color: rgb(254, 151, 84);
  }

  footer>div:nth-child(2).active {
    background-image: url(./image/footer/groupbuy_act.png);
    color: rgb(254, 151, 84);
  }

  footer>div:nth-child(3).active {
    background-image: url(./image/footer/find_act.png);
    color: rgb(254, 151, 84);
  }

  footer>div:nth-child(4).active {
    background-image: url(./image/footer/my_act.png);
    color: rgb(254, 151, 84);
  }

  .header-item {
    position: relative;
    display: none;
  }

  .header-item-act {
    display: block;
  }

  header>div:nth-child(1) {
    position: relative;
    background-color: white;
    height: 50px;   
  }

  header>div:nth-child(2) {
    position: relative;
    height: 50px;
    background-color: rgb(252, 252, 252);
  }

  header>div:nth-child(3) {
    position: relative;
    height: 50px;
    background-color: rgb(252, 252, 252);
  }
  /* header home */

  .home-citylist {
    float: left;
    height: 50px;
    line-height: 50px;
    color: #fff;
    font-size: 14px;
    margin-left: 15px;
  }

  .home-citylist>img {
    height: 20px;
    vertical-align: top;
    padding-top: 15px;
  }

  .home-search {
    position: absolute;
    bottom: 8px;
    left: 9px;
    right: 9px;
    height: 34px;
    line-height: 34px;
    background-color:#000;
    border-radius: 34px;
    color: white;
    font-size: 14px;
  }

  .home-search>img {
    height: 20px;
    padding-top: 7px;
    padding-left: 10px;
    padding-right: 10px;
    vertical-align: top;
  }


  .find-search {
    position: absolute;
    bottom: 8px;
    left: 15px;
    right: 60px;
    height: 34px;
    line-height: 34px;
    font-size: 16px;
  }

</style>
</head>

<body>
  <header id="header">
    <div class="header-item header-item-act" id="home">
      <div class="home-search open-win" win="html/search">
        <img src="./image/header/search_home.png">
        <span>搜索其实很简单</span>
      </div>
    </div>
    <div class="header-item" id="find">
      <div class="find-search open-win">
       热推短视频
     </div>

   </div>
   <div class="header-item" id="my">
   </div>
 </header>
 <section></section>
 <footer id="footer">
  <div class="menu active" tapmode="active" onclick="fnChange(0)">首页</div>
  <div class="menu" tapmode="active" onclick="fnChange(1)">热推</div>
  <div class="menu" tapmode="active" onclick="fnChange(2)">潮视</div>
  <div class="menu" tapmode="active" onclick="fnChange(3)">我的</div>
</footer>
</body>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript" src="./script/common.js"></script>
<script type="text/javascript" src="./script/localdb.js"></script>
<script type="text/javascript" src="./script/SHA1.js"></script>
<script type="text/javascript">
  apiready = function() {
    // initPushGeTui();
    WareTypeList();
    fnReadyOpenWin();
    fnInit();

    fnOpenDatabase();
    fnChange(0);

    fnGetLocation(function() {
      setTimeout(function() {
        fnOpenWelcome();
      }, 100);
    });
  };

  function fnInitListener() {
    var flag = false;
    api.addEventListener({
      name: 'keyback'
    }, function(ret, err) {
      if (false == flag) {
        api.toast({
          msg: '再按一次退出',
          duration: 2000,
          location: 'bottom'
        });
        flag = true;
        setTimeout(function() {
          flag = false;
        }, 2000);
      } else {
        api.closeWidget({
          silent: true
        });
      }
    });


  };



  var headers, footers, headerHeight, footerHeight;

  function fnInit() {
    var header = $api.byId('header');
    var footer = $api.byId('footer');

    headers = $api.domAll(header, '.header-item');
    footers = $api.domAll(footer, 'div');

    for (var i = 0; i < headers.length; i++) {
      $api.fixIos7Bar(headers[i]);
    }

    headerHeight = $api.offset(header).h;
    footerHeight = $api.offset(footer).h;
  };

  function fnOpenScanner() {
    var fnscanner = api.require('FNScanner');
    fnscanner.openScanner({}, function(ret, err) {
      if (ret && 'success' == ret.eventType) {
        alert(ret.content);
      }
    });
  };
  var frames = ['home_frame', 'newvideo', 'caoshi_frame', 'my_frame'];

  function fnChange(index) {
    
   for (var i = 0; i <=headers.length; i++) {
    if (index == i) {
      $api.addCls(headers[i], 'header-item-act');
      $api.addCls(footers[i], 'active');

      var y = 3 == index ? 0 : headerHeight;
      
      api.openFrame({
        name: frames[i],
        url: './html/' + frames[i] + '.html',
        bounces: false,
        bgColor: '#f0f0f0',
        vScrollBarEnabled: false,
        hScrollBarEnabled: false,
        rect: {
          x: 0,
          y: y,
          w: 'auto',
          h: api.frameHeight - y - footerHeight
        }
      });
    } else {
      $api.removeCls(headers[i], 'header-item-act');
      $api.removeCls(footers[i], 'active');

      api.setFrameAttr({
        name: frames[i],
        hidden: true
      });
    }
  }
};



function initPushGeTui(){
  var uzgetuisdk = api.require('pushGeTui');
  uzgetuisdk.initialize(function(ret) {
    var value = "";
    switch (ret.type) {
      case 'cid':
      value = 'cid:' + ret.cid;
      break;
      case 'payload':
      value = 'payload:' + ret.payload;
      fnpush(ret.payload);
      break;
      case 'occurError':
      value = 'occurError';
      break;
      case'onNotificationMessageClicked':
      value = 'onNotificationMessageClicked' + ret.onNotificationMessageClicked
      break;
      case'onNotificationMessageArrived':
      value = 'onNotificationMessageArrived' + ret.onNotificationMessageArrived
      break;
    }
  });
} 
function fnpush(payload){
  var ware=$api.strToJson(payload);
  api.openWin({
    name: 'html/ware',
    url: 'html/ware.html',
    pageParam: {
      wareId:ware.id
    },
    animation: {
      type: "fade"
    }
  });
}
function WareTypeList(){
  var WareTypeList=$api.getStorage('WareTypeList');
  getWareTypeList();
}
function getWareTypeList(){
 var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now
      var params={
        fields:{},
        where:{},
        skip:0,
        
      }
      params=$api.jsonToStr(params);
      api.ajax({
        url: 'http://d.apicloud.com/mcm/api/wareType?filter='+params,
        method: 'get',
        headers: {
          "X-APICloud-AppId": "A6099267504667",
          "X-APICloud-AppKey":   appKey
        },
      },function(ret, err){
        if (ret) {
         $api.setStorage('WareTypeList', ret);
       } else {
        // alert( err.msg );
      }
    });
    }


  </script>

  </html>
