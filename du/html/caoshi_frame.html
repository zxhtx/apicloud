<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <title>title</title>
  <link rel="stylesheet" type="text/css" href="../css/api.css" />
  <style>
  html,
  body {
    background-color: transparent;
  }

  #container {
    padding: 11px;  
    /*padding-bottom:11px;       */
  }

  #container>.card {
   background-image: url("../image/jiazai.gif");
   margin-bottom: 39px;        
   position: relative;
   float: left;
   padding: 4px;
   border-radius: 8%;
   box-sizing: border-box;
   background-clip: content-box;
   background-position: center;
   background-repeat: no-repeat;
   background-size: cover;

 }

 #container>.card>.favorite {
  position: absolute;
  width: 14px;
  height: 13px;
  left: 15.5px;
  top: 17px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  background-image: url(../image/favorite-list.png);
}

#container>.card>.room-name {
  position: absolute;
  left: 14px;
  bottom: 13px;
  height: 16.5px;
  line-height: 16.5px;
  font-size: 16.5px;
  color: white;
}

#container>.card>.gender {
  position: absolute;
  bottom: 15px;
  right: 30.5px;
  width: 13px;
  height: 13px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  background-image: url(../image/male.png);
}

#container>.card>.age {
  position: absolute;
  right: 11px;
  bottom: 13px;
  font-size: 14px;
  line-height: 14px;
  color: white;
}
.card>img{
  display:none;
}


.card>p{
  position: absolute;
  bottom: -30px;  
  font-size: 16px;
}
</style>
</head>

<body>
  <div id="container">

  </div>
  <!-- <div class="push-status" id="pushStatus">上拉显示更多</div> -->
</body>
<script type="text/template" id="template">

</script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript">
  var skip = 0;
  var LIMIT = 200;

  var city = null;
  var favorite = false;
  var UIScrollPlayer; 
  var video;
  var videonull;
  var play=0;
  apiready = function() {
    UIScrollPlayer = api.require('UIScrollPlayer');
    eventlister();
    video=[];
    videonull=[];
    fnLoadList();






  };



  function fnLoadList(_LoadMore) {
    if (_LoadMore) {
      skip+=LIMIT;
    }else{

      skip=0;
    }
    var params={
      fields:{},
      fields: {},
      skip:skip,
      limit:LIMIT,
      order:"createdAt DESC"
    }
    params=$api.jsonToStr(params);

    var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now;
      api.ajax({
        url: 'https://d.apicloud.com/mcm/api/video1?filter='+params,
        headers: {
          'X-APICloud-AppId': 'A6099267504667',
          'X-APICloud-AppKey': appKey
        },
        method: 'get'
      }, function(ret, err) {

       fnOpenRoom(ret);
       eventlister(ret);
     // alert(videourl)

     // alert(videourl)


   });
    }


    function  eventlister(element){

      var UIScrollPlayer = api.require('UIScrollPlayer');
      UIScrollPlayer.addEventListener(function(ret, err){

        if (ret.evenType=='onSingleTapUp') {
         onSingleTapUp();

       }else if (ret.evenType=='onDoubleTap') {

        api.execScript({
            // name: 'video',
            frameName: 'video',
            script: 'zan();'
          });

      }


    });
    }
      // 监听单击
      function onSingleTapUp(){
        if (play==0) {
          UIScrollPlayer.pause();
          play=1;
          api.toast({
            msg: '已暂停',
            duration: 2000,
            location: 'bottom'
          });
        }else{
          UIScrollPlayer.play();
          play=0;
          api.toast({
            msg: '继续播放',
            duration: 2000,
            location: 'bottom'
          });
        }
      }


      
      function fnOpenRoom(ret){
        

        for (var i = 0; i <ret.length; i++) {
          if (ret[i].video==null  ||  ret[i].video==''  || ret[i].video==undefined) {
            ret[i].video=new Date;
            videonull.push({
              imageUrl:'',
              videoUrl:ret[i].video
            })
          }else{
            video.push({
             imageUrl:'',
             videoUrl:ret[i].video.url
           })
          }

        }

       UIScrollPlayer.open({
        rect : {
          x : 0,
          y : 0,
          w : api.frameWidth,
          h : api.frameHeight,
        },
        videos : video,
        fixed:true,
      },function(ret, err){
            // alert(JSON.stringify(ret));
          });

       setTimeout(function() {
          // 你有几个显示的你就对应打开几个按钮   x  y是定义这个坐标的位置
          api.openFrame({
            name: 'video',
            url: './video.html',
            rect: {
              x: api.winWidth-50,
              y: api.winHeight/2+38,
              h: api.winHeight/2,
              w: 50
            },
            bgColor: 'rgba(0,0,0,0)',
          });


          api.openFrame({
            name: 'backimg_frame',
            url: './backimg_frame.html',
            rect: {
              x: 8,
              y: 28,
              w: 50,
              h: 50
            },
            bgColor: 'rgba(0,0,0,0)',

          });


          api.openFrame({
            name: 'xiangji_frame',
            url: './xiangji_frame.html',
            rect: {
              x: api.winWidth-38,
              y: 28,
              w: 50,
              h: 50
            },
            bgColor: 'rgba(0,0,0,0)',

          });
        }, 200);




    };

    function videopuase(){
      UIScrollPlayer.pause();
      play=1;

    }





  //     function fnRenderList(ret,_LoadMore) {

  //       if (_LoadMore) {
  //         fnOpenRoom(ret,_LoadMore)
  //       }
  //   // 优化
  //   api.parseTapmode();

  //   api.refreshHeaderLoadDone();
  // }
  // function initEventListenter(){
  //   api.addEventListener({
  //     name:'scrolltobottom',
  //     extra:{
  //       threshold:100
  //     }
  //   }, function(ret, err){        
  //    // fnLoadList(true);
  //    alert(到底了)
  //  });
  // }
</script>

</html>
