<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <title>title</title>
  <link rel="stylesheet" type="text/css" href="../css/api.css" />
  <style>
  html,
  body {
    background-color: transparent;
  }

  #container {
    padding: 11px;  
    /*padding-bottom:11px;       */
  }

  #container>.card {
   background-image: url("../image/jiazai.gif");
   margin-bottom: 39px;        
   position: relative;
   float: left;
   padding: 4px;
   border-radius: 8%;
   box-sizing: border-box;
   background-clip: content-box;
   background-position: center;
   background-repeat: no-repeat;
   background-size: cover;

 }

 #container>.card>.favorite {
  position: absolute;
  width: 14px;
  height: 13px;
  left: 15.5px;
  top: 17px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  background-image: url(../image/favorite-list.png);
}

#container>.card>.room-name {
  position: absolute;
  left: 14px;
  bottom: 13px;
  height: 16.5px;
  line-height: 16.5px;
  font-size: 16.5px;
  color: white;
}

#container>.card>.gender {
  position: absolute;
  bottom: 15px;
  right: 30.5px;
  width: 13px;
  height: 13px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  background-image: url(../image/male.png);
}

#container>.card>.age {
  position: absolute;
  right: 11px;
  bottom: 13px;
  font-size: 14px;
  line-height: 14px;
  color: white;
}
.card>img{
  display:none;
}


.card>p{
  position: absolute;
  bottom: -30px;  
  font-size: 16px;
}
</style>
</head>

<body>
  <div id="container">

  </div>
  <!-- <div class="push-status" id="pushStatus">上拉显示更多</div> -->
</body>
<script type="text/template" id="template">

</script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript">
  var skip = 0;
  var LIMIT = 31;
  var city = null;
  var favorite = false;
  var UIScrollPlayer; 
  var video;
  var videonull;
  var addvideo;
  var addvideonull;
  var retele;
  var nullretele;
  var mevideo;
  apiready = function() {
    UIScrollPlayer = api.require('UIScrollPlayer');
    video=[];
    videonull=[];
    addvideo=[];
    addvideonull=[];
    retele=[];
    nullretele=[];
    fnLoadList();

    setInterval(addEventListenerplay,1000)
    mevideo=api.pageParam.name



  };
  function addEventListenerplay(){
   UIScrollPlayer.play();
 }


 function fnLoadList(_LoadMore) {
  // var jishu;
  if (_LoadMore) {
    // jishu=skip;
    skip+=LIMIT;
     // alert(skip)
     // alert(jishu)

   }else{

    skip=0;
  }


  if (api.pageParam.name=='mevideo') {
   var userInfo=$api.getStorage('user');
   var params={
    fields:{},
    fields: {},
    skip:skip,
    limit:LIMIT,
    where:{userid:userInfo[0].id},
    order:"createdAt DESC"
  }
}else{
 var params={
  fields:{},
  fields: {},
  skip:skip,
  limit:LIMIT,
  order:"createdAt DESC"
}
}


params=$api.jsonToStr(params);

var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now;
      api.ajax({
        url: 'https://d.apicloud.com/mcm/api/video1?filter='+params,
        headers: {
          'X-APICloud-AppId': 'A6099267504667',
          'X-APICloud-AppKey': appKey
        },
        method: 'get'
      }, function(ret, err) {
        if (api.pageParam.name=='mevideo') {
          if (ret==null || ret==undefined || ret=='') {
            activity.closeKeyFrame();
            api.execScript({
              name: 'personalcenter',
              frameName: 'personalcenter_frame',
              script: 'nullvideo();'
            });

            api.closeFrame({
              name: 'caoshi_frame'
            });
          }
        }
        if (_LoadMore) {
          addRoom(ret);
        }else{
          fnOpenRoom(ret);
        }

        for (var i = 0; i <ret.length; i++) {
          if (ret[i].video==null  ||  ret[i].video==''  || ret[i].video==undefined) {
            ret[i].video=new Date;
            nullretele.push({
              imageUrl:'',
              videoUrl:ret[i].video+ret[i].id+ret[i].title+ret[i].userid+ret[i].username+ret[i].like
            })
          }else{
            retele.push({
             id:ret[i].id,
             video:ret[i].video.url,
             title:ret[i].title,
             userid:ret[i].userid,
             username:ret[i].username,
             like:ret[i].like
           })
          }

        }



      });
    }


    function  eventlister(element){
     UIScrollPlayer.addEventListener(function(ret, err){
      api.sendEvent({
        name: 'userandtext',
        extra: {
          key1: retele[ret.index], 
        }
      });
      if (ret.index>=30) {
        if (ret.index%30==0) {
          fnLoadList(true)
          
        }
        
      }

      if (ret.evenType=='onSingleTapUp') {
       // onSingleTapUp();

     }else if (ret.evenType=='onDoubleTap') {

      api.execScript({
            // name: 'video',
            frameName: 'video',
            script: 'zan();'
          });

    }


  });
   }
      // 监听单击暂停or播放
      
      function addRoom(ret){
       eventlister();
       for (var i = 0; i <ret.length; i++) {
        if (ret[i].video==null  ||  ret[i].video==''  || ret[i].video==undefined) {
          ret[i].video=new Date;
          addvideonull.push({
            imageUrl:'',
            videoUrl:ret[i].video
          })
        }else{
          addvideo.push({
           imageUrl:'',
           videoUrl:ret[i].video.url
         })
        }

      }
      UIScrollPlayer.add({
        videos :addvideo
      });
      addvideo=[];
    }

    function fnOpenRoom(ret){
     eventlister();

     for (var i = 0; i <ret.length; i++) {
      if (ret[i].video==null  ||  ret[i].video==''  || ret[i].video==undefined) {
        ret[i].video=new Date;
        videonull.push({
          imageUrl:'',
          videoUrl:ret[i].video
        })
      }else{
        video.push({
         imageUrl:'',
         videoUrl:ret[i].video.url
       })
      }

    }

    UIScrollPlayer.open({
      rect : {
        x : 0,
        y : 0,
        w : api.frameWidth,
        h : api.frameHeight,
      },
      videos : video,
      fixed:true,
    },function(ret, err){

    });

    setTimeout(function() {
          // 你有几个显示的你就对应打开几个按钮   x  y是定义这个坐标的位置
          api.openFrame({
            name: 'video',
            url: './video.html',
            rect: {
              x: api.winWidth-50,
              y: api.winHeight/2+60,
              h: api.winHeight/2,
              w: 50
            },
            bgColor: 'rgba(0,0,0,0)',
          });


          api.openFrame({
            name: 'backimg_frame',
            url: './backimg_frame.html',
            rect: {
              x: 8,
              y: 28,
              w: 50,
              h: 50
            },
            bgColor: 'rgba(0,0,0,0)',

          });
          api.openFrame({
            name: 'userheaderimg_frame',
            url: './userheaderimg_frame.html',
            rect: {
              x: api.winWidth-52,
              y: api.winHeight/2-20,
              h: api.winHeight/8,
              w: 60
            },
            pageParam: {
              mevideo: mevideo
            },
            bgColor: 'rgba(0,0,0,0)',

          });

          api.openFrame({
            name: 'videotitle_frame',
            url: './videotitle_frame.html',
            rect: {
              x: 10,
              y: api.winHeight/2+275,
              h: api.winHeight/2-240,
              w: api.winWidth-100
            },
            bgColor: 'rgba(0,0,0,0)',

          });
          api.openFrame({
            name: 'videouser_frame',
            url: './videouser_frame.html',
            rect: {
              x: 10,
              y: api.winHeight/2+250,
              h: api.winHeight/2-250,
              w: api.winWidth/3+30
            },
            bgColor: 'rgba(0,0,0,0)',

          });


          api.openFrame({
            name: 'xiangji_frame',
            url: './xiangji_frame.html',
            rect: {
              x: api.winWidth-38,
              y: 28,
              w: 50,
              h: 50
            }, 

            pageParam: {
              name: mevideo
            },
            bgColor: 'rgba(0,0,0,0)',

          });
        }, 200);




  };

  function videopuase(){
    UIScrollPlayer.pause();
    play=1;

  }




</script>

</html>
