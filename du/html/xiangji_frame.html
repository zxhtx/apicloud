<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <title>title</title>
  <link rel="stylesheet" type="text/css" href="../css/api.css" />
  <style>
  html ,body{
    background-color: transparent;
    /*border: 1px solid red;*/
  }
  #list>.img{
    /*border:1px solid red;*/
  }
/*#list>#icon{
  margin-bottom:20px;
  border-radius: 50%;
  border-color: black; 
  }  */
  
</style>
</head>

<body>
  <div id="list">
    <img class="img" id="zan" tapmode onclick="xiangji()" src="../image/photo.png" alt="" width="28px" height="28px"> 
  </div>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
 var dialogBox;
 var recordVideo;
 var texts;
 var videourl;
 apiready = function() {
  dialogBox = api.require('dialogBox');
  recordVideo = api.require('weChatVideo');
  



};

function xiangji(){

  api.execScript({
        // name: 'winName',
        frameName: 'caoshi_frame',
        script: 'videopuase();'
      });
  var userInfo=$api.getStorage('userInfo');
  if (userInfo==undefined && userInfo==null) {
    var dialogBox = api.require('dialogBox');
    dialogBox.alert({
      texts: {
        title: '未登录',
        content: '您还没登录啦[○･｀Д´･ ○]',
        leftBtnTitle: '确认',
      },
      styles: {
        bg: '#fff',
        w: 300,
        corner:2,
        title: {
          marginT: 18,
          titleSize: 14,
          titleColor: '#000'
        },
        content: {
          color: '#000',
          size: 14
        },
        left: {
          marginB: 7,
          marginL: 88,
          w: 130,
          h: 35,
          corner: 8,
          bg: '#000',
          size: 12,
          color: '#fff',
        },

      }
    },function(ret) {
      if (ret.eventType == 'left') {
        api.openWin({
          name: 'login',
          url: './login.html',
          pageParam: {
            ware: api.pageParam.wareId 
          },
          animation: {
            type: "fade"
          }
        });
        dialogBox.close();
      }
    });  

    return;
  }else{

    dialogBox.alert({
      texts: {
        title: '拍摄',
        content: '选择拍摄方式',
        leftBtnTitle: '相机',
        rightBtnTitle: '相册'
      },
      styles: {
        bg: '#fff',
        w: 300,
        corner:2,
        title: {
          marginT: 20,
          icon: 'widget://res/gou.png',
          iconSize: 40,
          titleSize: 14,
          titleColor: '#000'
        },
        content: {
          color: '#000',
          size: 14
        },
        left: {
          marginB: 7,
          marginL: 20,
          w: 130,
          h: 35,
          corner: 2,
          bg: '#000000',
          color:'#ffffff',
          size: 12
        },
        right: {
          marginB: 7,
          marginL: 10,
          w: 130,
          h: 35,
          corner: 2,
          bg: '#000000',
          color:'#ffffff',
          size: 12
        }
      }
    }, function(ret) {
      if (ret.eventType == 'left') {   
       recordVideo.open({
        maxTime: 60,
        isEditVideo:true
      }, function(data){
        if (data.status==true) {
          videourl=data.videourl;
          dialogBox.input({
            keyboardType: 'default',
            texts: {
              title: '发表视频',
              placeholder: '说两句吧',
              leftBtnTitle: '取消',
              rightBtnTitle: '确定'
            },
            styles: {
              bg: '#fff',
              corner: 2,
              w: 300,
              h: 240,
              title: {
                h: 60,
                alignment: 'center',
                size: 14,
                color: '#000',
                marginT:30,
              },
              input: {
                h: 60,
                y:30,
                marginT:15,
                marginLeft: 10,
                marginRight:10,
                textSize: 14,
                textColor: '#000'
              },
              dividingLine: {
                width: 0.5,
                color: '#696969'
              },
              left: {
                bg: 'rgba(0,0,0,0)',
                color: '#007FFF',
                size: 12
              },
              right: {
                bg: 'rgba(0,0,0,0)',
                color: '#007FFF',
                size: 12
              }
            }
          }, function(ret) {

            if (ret.eventType == 'left') {

              dialogBox.close({
                dialogName: 'input'
              });
            }else{ 
              texts=ret.text;

              dialogBox.close({
                dialogName: 'input'
              });

            }
          });

        }
      })
       dialogBox.close({
        dialogName: 'alert'
      });
     }else{

      api.getPicture({
        sourceType: 'library',
        encodingType: 'jpg',
        mediaValue: 'video',
        destinationType: 'url',
        allowEdit: true,
        quality: 50,
        saveToPhotoAlbum: false
      }, function(ret, err){ 
        if(ret){
          if (ret.data!='') {
            videourl=ret.data;
            dialogBox.input({
              keyboardType: 'default',
              texts: {
                title: '发表视频',
                placeholder: '说两句吧',
                leftBtnTitle: '取消',
                rightBtnTitle: '确定'
              },
              styles: {
                bg: '#fff',
                corner: 2,
                w: 300,
                h: 240,
                title: {
                  h: 60,
                  alignment: 'center',
                  size: 14,
                  color: '#000',
                  marginT:30,
                },
                input: {
                  h: 60,
                  y:30,
                  marginT:15,
                  marginLeft: 10,
                  marginRight:10,
                  textSize: 14,
                  textColor: '#000'
                },
                dividingLine: {
                  width: 0.5,
                  color: '#696969'
                },
                left: {
                  bg: 'rgba(0,0,0,0)',
                  color: '#007FFF',
                  size: 12
                },
                right: {
                  bg: 'rgba(0,0,0,0)',
                  color: '#007FFF',
                  size: 12
                }
              }
            }, function(ret) {

              if (ret.eventType == 'left') {

                dialogBox.close({
                  dialogName: 'input'
                });
              }else{ 

                texts=ret.texts;

                dialogBox.close({
                  dialogName: 'input'
                });

              }
            });


          }
        }
      });
      dialogBox.close({
        dialogName: 'alert'
      });
    }
  });
}

}



</script>

</html>
