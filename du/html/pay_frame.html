<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../css/api.csss"/>
	<style>
	.text{
		text-align: center;

	}
	#price{
		text-align: center;
		font-size: 28px;
		font-weight: bold;
	}
	.pay{
		width: 100%
		margin: 0 auto;

	}
	.div1{
		width:100%;
		text-align:center;
		line-height: 28px; 
		height:28px;
		background: green;
		margin-top:88px;
		padding-top: 10px;
		padding-bottom: 10px;
		border-radius: 20px;
		color: white;
	}
	.div2{
		width:100%;
		padding-top: 10px;
		padding-bottom: 10px;
		text-align:center;
		line-height:28px; 
		height:28px;
		background: #7DC4E6;
		margin-top: 28px;
		border-radius: 20px;
		color: white;
	}
	.pp{
		text-align: center;
		font-size: 12px;
		color: black;
		margin-top: 38px;

	}
	.paygengduo{
		margin: 0 auto;
		text-align: center;
		margin-top: 100px;
		color: blue;
		width: 188px;
	}
</style>
</head>
<body>
	<div>
		<p id="text" class="text"></p>
		<p class="pp">(第三方平台可能会收取手续费1-5分钱 以第三方平台金额为准)</p>
	</div>
	<div class="pay">
		<div class="div1" tapmode onclick="weixin()">微信支付</div>
		<div class="div2" tapmode onclick="alipay()">支付宝支付</div>

		<div class="paygengduo" tapmode onclick="openpaygengduo()">支付步骤</div>
	</div>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript">
	var name;
	var price1;
	var wareid;
	var myDate = new Date();
	var order_id=myDate.getTime(); 
	
	var value;
	var pay_type;
	apiready = function(){
		getshoppinginformation();
		
	};
	function openpaygengduo(){
		api.openWin({
			name: 'paygengduo',
			url: './paygengduo.html',
			pageParam: {
				name: 'test'
			}
		});
	}
	var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now
      function getshoppinginformation(){
      	var params={
      		fields:{},
      		fields: {},
      		where: {
      			id:api.pageParam.ware.id
      		},
      		skip:0
      	}
      	params=$api.jsonToStr(params);
      	api.ajax({
      		url: 'http://d.apicloud.com/mcm/api/shoppinginformation?filter='+params,
      		method: 'get',
      		headers: {
      			"X-APICloud-AppId": "A6099267504667",
      			"X-APICloud-AppKey":   appKey
      		},

      	},function(ret, err){
      		if (ret) {
            // 赋值
            // updateWare(ret);
            name=ret[0].warename;
            price1=ret[0].price;
            wareid=ret[0].id;
            var text=$api.byId('text');
            text.innerHTML=ret[0].description;

            // alert($api.jsonToStr(ret))
            
        } else {
        	api.toast({
        		msg: err.msg,
        		duration: 2000,
        		location: 'bottom'
        	});
        }
    });


      }

      function weixin(){
      	api.openWin({
      		name: 'page1',
      		url: "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=wechat"
      	});
      	// api.openApp({
      	// 	androidPkg: 'android.intent.action.VIEW',
      	// 	mimeType: 'text/html',
      	// 	uri: "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=wechat"
      	// }, function(ret, err) {
      	// 	if (ret) {

      	// 	}
      	// });
      	// location.href = "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=wechat";


      }

      function alipay(){
      	api.openWin({
      		name: 'page1',
      		url: "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=alipay"
      	});
      	// api.openApp({
      	// 	androidPkg: 'android.intent.action.VIEW',
      	// 	mimeType: 'text/html',
      	// 	uri:  "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=alipay"
      	// }, function(ret, err) {
      	// 	if (ret) {

      	// 	}
      	// });


      	// location.href = "http://www.zxh.yueaa.com/bufpay_/bufpay_api_demo.php?price=" + price1 +"&date="+ order_id +"&wareid="+ wareid +"&name="+ name + "&pay_type=alipay";



      }
  </script>
  </html>