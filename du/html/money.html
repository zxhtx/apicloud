<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>我的账户</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
    html,
    body {
        height: 100%;
        background-color: #f0f0f0;
    }
    
    header {
        position: relative;
        width: 100%;
        height: 150px;
        background-color:#ffffff ;
    }
    
    header .back {
        position: absolute;
        bottom: 100px;
        left: 0;
        width: 80px;
        height: 40px;
        z-index: 2;
    }
    
    header .back img {
        margin-top: 16px;
        margin-left: 12px;
        width: 11px;
        height: 18px;
    }
    
    header .right {
        position: absolute;
        right: 12px;
        bottom: 100px;
        width: 40px;
        height: 40px;
    }
    
    header .right .accounthelp {
        position: absolute;
        top: 13px;
        right: 0;
        width: 33px;
        height: 24px;
        font-size:15px; 
    }
    
    header .top {
        position: relative;
        top: 50px;
        width: 100%;
        height: 40px;
        color: #000;
        line-height: 40px;
        font-size: 14px;
        text-align: center;
    }
    
    header .bottom {
        position: relative;
        top: 50px;
        width: 100%;
        height: 40px;
        color: #000;
        line-height: 40px;
        font-size: 24px;
        font-weight: bolder;
        text-align: center;
    }
    
    #pay{
        width: 100%;
        height: 200px;
        /*border: 1px solid red;*/
    }
    .tixian{
        width: 100%;
        height: 100px;
        /*border: 1px solid green;*/


    }
    #tixian{
        width: 80%;
        height: 50px;
        margin: 0 auto;
        line-height: 50px;
        text-align: center;
        color: white;
        background-color: black;
        font-size: 16px;
        margin-top: 25px;
        border-radius: 25px;
    }
    .text{
        color: gray;
        text-align: center;
        font-size: 12px;
        margin-top:25px;
    }
    #frame1>div{
        width: 100px;
        height: 30px;
        text-align: center;
        line-height: 30px;
        border-radius: 8px;
        margin-left: 12px;
        margin-top:38px; 
        color: white;
        background-color: black;
        display: inline-block;

    }

    #frame2>div{
     width: 100px;
     height: 30px;
     text-align: center;
     line-height: 30px;
     border-radius: 8px;
     margin-left: 12px;
     margin-top: 38px;
     color: white;
     background-color: black;
     display: inline-block;

 }
</style>
</head>

<body>
    <header id="header">
        <div class="back" tapmode onclick="api.closeWin();">
            <img src="../image/back.png">
        </div>
        <div class="right" tapmode onclick="Openjilu();">
            <div class="accounthelp">记录</div>
        </div>
        <div class="top">潮袭余额</div>
        <div class="bottom" id="price">￥</div>
    </header> 
    <nav id="nav">
        <div id="pay">
            <div id="frame1">
                <div tapmode onclick="pay(1)">1元</div>
                <div tapmode onclick="pay(5)">5元</div>
                <div tapmode onclick="pay(10)">10元</div>
            </div>
            <div id="frame2">
                <div tapmode onclick="pay(20)">20元</div>
                <div tapmode onclick="pay(30)">30元</div>
                <div tapmode onclick="pay(50)">50元</div>
            </div>
        </div>

        <div class="tixian">

            <div id="tixian" tapmode onclick="tixian()">
                全部提现
            </div>
        </div>
        <p class="text">注:余额提现官方会扣取10%的金额</p>
    </nav>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript">
   var dialogBox;
   var name;
   var price=1;
   var wareid;
   var myDate = new Date();
   var Y=myDate.getFullYear();
   var M=myDate.getMonth()+1;
   var D=myDate.getDate();  
   var h=myDate.getHours();    
   var m=myDate.getMinutes();
   var s=myDate.getSeconds(); 
   var order_id=Y+'-'+M+'-'+D+' '+h+':'+m+':'+s;
   var userid;
   var value;
   var pay_type;
   var tixianprice;
   apiready = function() {

    var header = $api.byId('header');
    $api.fixStatusBar(header);
    api.setStatusBarStyle({
        style: 'light',
        color:'#000'
    });
    dialogBox = api.require('dialogBox');
    userid=$api.getStorage('userInfo').userId;
    getusermoney();


}
function tixian(){
    if (tixianprice<1) {
        api.toast({
            msg: '账户余额不足',
            duration: 3000,
            location: 'bottom'
        });
    }else{
        tixianprice=tixianprice*0.9;
        var FNScanner = api.require('FNScanner');
        FNScanner.encodeImg({
            content: order_id+'/'+tixianprice,
            saveToAlbum: true,
            saveImg: {
                path: 'fs://tixian.png',
                w: 200,
                h: 200
            }
        }, function(ret, err) {
            if (ret.status) {
               api.toast({
                   msg: '提现成功(本机手机相册生成一张二维码,请加客服微信,把二维码发给客服进行提现)',
                   duration: 12000,
                   location: 'bottom'
               });
               var price=$api.byId('price');
               price.innerHTML='￥0.00';
               tixianok();

           }
       });
    }

}
function tixianok(){
   var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now;


      api.ajax({
        url: 'http://d.apicloud.com/mcm/api/user/'+userid,
        method: 'put',
        headers: {
            "X-APICloud-AppId": "A6099267504667",
            "X-APICloud-AppKey":   appKey
        },
        data: {
            values:{
                money:0.00
            }
        },

    },function(ret, err){
        if (ret) {


        } 
    });

  }
  function getusermoney(){
     var now = Date.now();
      //5FB51794-FCDC-1FE9-19E0-xxxxxxxxxxxx换成自己appkey
      var appKey = SHA1("A6099267504667"+"UZ"+"8FC0173C-B395-B797-D516-7A6CD23939B3"+"UZ"+now)+"."+now;
      var params={
        fields:{},
        fields: {},
        where: {
            id:userid
        },
    }
    params=$api.jsonToStr(params);
    api.ajax({
        url: 'http://d.apicloud.com/mcm/api/user?filter='+params,
        method: 'get',
        headers: {
            "X-APICloud-AppId": "A6099267504667",
            "X-APICloud-AppKey":   appKey
        },

    },function(ret, err){
        if (ret) {
         tixianprice=ret[0].money;
         var price=$api.byId('price');
         if (ret[0].money) {

          price.innerHTML='￥'+ret[0].money;
      }else{
        price.innerHTML='￥0.00';
    }

} 
});
}
function pay(money){

    dialogBox.actionMenu ({
        rect:{
            h: 150
        },
        texts:{
         cancel: '取消'
     },
     items:[
     {
        text: '微信支付',
        icon: 'widget://image/wxpay.png'
    },
    {
        text: '支付宝支付',
        icon: 'widget://image/zfb.png'
    }
    ],
    styles:{
        bg:'#FFF',
        column: 3,
        itemText: {
            color: '#000',
            size: 12,
            marginT:8
        },
        itemIcon:{
            size:80
        },
        cancel:{  
            bg: 'fs://icon.png',   
            color:'#000',          
            h: 44 ,                 
            size: 14       
        }
    }
}, function(ret){
    if (ret.index==0) {
        weixin(money);

    }else if (ret.index==1){
        alipay(money)
    }else{
        dialogBox.close({
            dialogName: 'actionMenu'
        });
    }
});

}

function weixin(money){
    // alert(money)
    dialogBox.close({
        dialogName: 'actionMenu'
    });

    api.toast({
        msg: '请稍等',
        duration: 2000,
        location: 'bottom'
    });
    location.href = "http://www.zxh.yueaa.com/pay/bufpay_api_demo.php?price="+money+"&date="+ order_id +"&uid="+ userid  +"&name=vip"+ order_id + "&pay_type=wechat";



}

function alipay(money){
    // alert(money)
    dialogBox.close({
        dialogName: 'actionMenu'
    });
    api.toast({
        msg: '请稍等',
        duration: 2000,
        location: 'bottom'
    });
    location.href = "http://www.zxh.yueaa.com/pay/bufpay_api_demo.php?price="+money+"&date="+ order_id +"&uid="+  userid  +"&name=vip"+ order_id  + "&pay_type=alipay";



}
function Openjilu(){
    dialogBox.share({
        rect: {
            w: 300,
            h: 300
        },
        items: [{
            text: '消费账单',
            icon: 'widget://image/xiaofei.png'
        }, {
            text: '收益账单',
            icon: 'widget://image/shouyi.png'
        }, {
            text: '取消',
            icon: 'widget://image/close.png'
        }],
        styles: {
            bg: '#FFF',
            column: 3,
            horizontalSpace: 15,
            verticalSpace: 30,
            itemText: {
                color: '#000',
                size: 15,
                marginT: 10
            },
            itemIcon: {
                size: 80
            }
        }
    }, function(ret) {
        if (ret.index==0) {
            api.openWin({
                name: 'xiaofei',
                url: './xiaofei.html',
                pageParam: {
                    name: 'test'
                },
                animation: {
                  type: "fade"
              },
          });
            dialogBox.close({
                dialogName: 'share'
            });

        }else if(ret.index==1){

            api.openWin({
                name: 'shouyi',
                url: './shouyi.html',
                pageParam: {
                    name: 'test'
                },
                animation: {
                  type: "fade"
              },
          });
            dialogBox.close({
                dialogName: 'share'
            });


        }else{
           dialogBox.close({
            dialogName: 'share'
        });

       }
   });

}
</script>

</html>
